language: ruby

services:
  - postgresql
  - redis-server

env:
  global:
    - RAILS_MAX_THREADS=5

    - POSTGRES_HOST=localhost
    - POSTGRES_PORT=5432
    - POSTGRES_USER=postgres
    - POSTGRES_PASSWORD=''
    - POSTGRES_DB=partynest_test

    - SIDEKIQ_CLIENT_REDIS_HOST=localhost
    - SIDEKIQ_CLIENT_REDIS_PORT=6379
    - SIDEKIQ_CLIENT_REDIS_DB=0
    - SIDEKIQ_CLIENT_REDIS_PASSWORD=

    - SIDEKIQ_SERVER_REDIS_HOST=localhost
    - SIDEKIQ_SERVER_REDIS_PORT=6379
    - SIDEKIQ_SERVER_REDIS_DB=0
    - SIDEKIQ_SERVER_REDIS_PASSWORD=

    - RAILS_CACHE_REDIS_HOST=localhost
    - RAILS_CACHE_REDIS_PORT=6379
    - RAILS_CACHE_REDIS_DB=1
    - RAILS_CACHE_REDIS_PASSWORD=

before_install:
  - sudo apt install qt4-qmake libqt4-dev libqtwebkit-dev xvfb

install:
  - bundle install --jobs=3 --retry=3
  - npm install

before_script:
  - psql -U postgres -c "CREATE DATABASE partynest_test;"

script: xvfb-run -a bundle exec rake

after_script:
  - bundle exec rake coveralls:push

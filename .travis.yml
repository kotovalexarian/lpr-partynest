language: ruby

services:
  - postgresql

env:
  global:
    - POSTGRES_HOST=localhost
    - POSTGRES_PORT=5432
    - POSTGRES_USER=postgres
    - POSTGRES_PASSWORD=''
    - POSTGRES_DB=partynest_test

before_install:
  - sudo apt install qt4-qmake libqt4-dev libqtwebkit-dev xvfb

install:
  - bundle install --jobs=3 --retry=3
  - npm install

before_script:
  - psql -U postgres -c "CREATE DATABASE partynest_test;"

  - curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 > ./cc-test-reporter
  - chmod +x ./cc-test-reporter
  - ./cc-test-reporter before-build

script: xvfb-run -a bundle exec rake

after_script:
  - ./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESULT
